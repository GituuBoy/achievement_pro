# State Management

The application utilizes **Redux Toolkit** for managing its global state. Redux Toolkit is the official, opinionated, batteries-included toolset for efficient Redux development, simplifying common Redux patterns and reducing boilerplate.

## 1. Redux Store Configuration

The Redux store is configured in [`frontend/src/store/index.ts`](frontend/src/store/index.ts). This file sets up the root reducer, middleware (like Redux Thunk for async logic), and development tools (like Redux DevTools Extension).

```typescript
// frontend/src/store/index.ts
import { configureStore } from '@reduxjs/toolkit';
import onboardingReducer from './slices/onboardingSlice';
// Import other reducers here

export const store = configureStore({
  reducer: {
    onboarding: onboardingReducer,
    // Add other reducers here
  },
  // middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(myMiddleware),
  // devTools: process.env.NODE_ENV !== 'production',
});

// Infer the `RootState` and `AppDispatch` types from the store itself
export type RootState = ReturnType<typeof store.getState>;
// Inferred type: {onboarding: OnboardingState, ...}
export type AppDispatch = typeof store.dispatch;
```

-   **`configureStore`**: A function from Redux Toolkit that wraps `createStore` and handles common setup tasks, such as combining reducers, adding Redux Thunk middleware, and setting up Redux DevTools.
-   **`reducer`**: An object where keys are the names of your slices in the state tree, and values are the corresponding slice reducers.
-   **`RootState`**: A TypeScript type that infers the entire shape of your Redux store's state. This is crucial for type safety when accessing state in components.
-   **`AppDispatch`**: A TypeScript type that infers the type of the `store.dispatch` function, including any middleware.

## 2. Structure of a Redux Slice

Redux Toolkit introduces the concept of "slices," which combine a reducer, its initial state, and its corresponding actions into a single file. This co-location makes Redux code more organized and easier to maintain.

An example slice, `onboardingSlice`, is located at [`frontend/src/store/slices/onboardingSlice.ts`](frontend/src/store/slices/onboardingSlice.ts):

```typescript
// frontend/src/store/slices/onboardingSlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface OnboardingState {
  projectName: string;
  // other onboarding related states
}

const initialState: OnboardingState = {
  projectName: '',
  // initial values for other states
};

const onboardingSlice = createSlice({
  name: 'onboarding',
  initialState,
  reducers: {
    setProjectName: (state, action: PayloadAction<string>) => {
      state.projectName = action.payload;
    },
    // Define other synchronous actions here
  },
  extraReducers: (builder) => {
    // Add reducers for async actions (e.g., from createAsyncThunk) here
  },
});

export const { setProjectName } = onboardingSlice.actions;
export default onboardingSlice.reducer;
```

-   **`createSlice`**: A function that accepts an object of reducer functions, a slice name, and an initial state value, and automatically generates a slice reducer with corresponding action creators and action types.
-   **`name`**: A string that will be used as the prefix for the generated action types (e.g., `'onboarding/setProjectName'`).
-   **`initialState`**: The initial state value for this slice of the Redux store.
-   **`reducers`**: An object containing "case reducer" functions. Each function handles a specific action type and directly modifies the `state` (thanks to Immer, which allows "mutating" logic inside reducers).
-   **`extraReducers`**: A builder callback that allows `createSlice` to respond to other action types not defined in this slice's `reducers` (e.g., actions from `createAsyncThunk` or other slices).
-   **`actions`**: The action creators generated by `createSlice`. You can destructure and export them for use in components.
-   **`reducer`**: The generated reducer function for this slice. It should be added to the `configureStore` `reducer` object.

## 3. How to Create New Slices and Actions

To add new state management for a feature:

1.  **Create a new slice file**: In `frontend/src/store/slices/`, create a new TypeScript file (e.g., `myFeatureSlice.ts`).
2.  **Define `interface` for state**: Define the TypeScript interface for the state managed by this slice.
3.  **Define `initialState`**: Provide the initial values for your slice's state.
4.  **Use `createSlice`**: Define your slice using `createSlice`, including its `name`, `initialState`, and `reducers`.
5.  **Export actions and reducer**: Export the generated action creators and the default reducer.
6.  **Add reducer to store**: Import the new reducer into `frontend/src/store/index.ts` and add it to the `reducer` object in `configureStore`.

## 4. Usage of Selectors to Access State

To read data from the Redux store in your React components, you use the `useSelector` hook from `react-redux`.

```typescript
// Example of accessing state in a React component
import React from 'react';
import { useSelector } from 'react-redux';
import { RootState } from '../store'; // Adjust path as necessary

const MyComponent: React.FC = () => {
  const projectName = useSelector((state: RootState) => state.onboarding.projectName);

  return (
    <div>
      <p>Project Name: {projectName}</p>
    </div>
  );
};

export default MyComponent;
```

-   **`useSelector`**: A hook that allows you to extract data from the Redux store state, using a selector function. When the selected state changes, the component will re-render.
-   **`RootState`**: Used to provide type safety for the `state` argument in the selector function.

## 5. Dispatching Actions

To update the state, components dispatch actions using the `useDispatch` hook from `react-redux`.

```typescript
// Example of dispatching an action in a React component
import React from 'react';
import { useDispatch } from 'react-redux';
import { setProjectName } from '../store/slices/onboardingSlice'; // Adjust path as necessary

const ProjectNameInput: React.FC = () => {
  const dispatch = useDispatch();

  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    dispatch(setProjectName(event.target.value));
  };

  return (
    <input
      type="text"
      placeholder="Enter project name"
      onChange={handleChange}
    />
  );
};

export default ProjectNameInput;
```

-   **`useDispatch`**: A hook that returns a reference to the `dispatch` function from the Redux store. You typically call it once and then use the returned `dispatch` function throughout your component.
-   **`setProjectName`**: An action creator imported from the `onboardingSlice`. When called with a payload, it creates an action object that can be dispatched to the store.